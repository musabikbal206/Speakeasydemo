<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History Heroes & Grammar (Bilingual + Audio)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .tab-content { display: none; animation: fadeIn 0.5s; }
        .tab-content.active { display: block; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .correct-anim { animation: bounce 0.5s; }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .speaking-anim { animation: pulse-ring 1.5s infinite; }
        @keyframes pulse-ring {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(251, 146, 60, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(251, 146, 60, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(251, 146, 60, 0); }
        }

        .word-move { transition: all 0.2s ease; }

        /* --- INTERACTIVE TEXT STYLES --- */
        .interactive-word {
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
            display: inline-block;
            padding: 0 2px;
            border-radius: 4px;
        }
        .interactive-word:hover {
            background-color: #ffedd5; /* light orange */
            color: #c2410c;
        }
        
        .sentence-wrapper {
            margin-bottom: 1.5rem;
            padding: 12px;
            border-radius: 12px;
            transition: background-color 0.3s, transform 0.2s;
            cursor: pointer;
            border: 1px solid transparent;
        }
        .sentence-wrapper:hover {
            background-color: #fffbeb; /* very light yellow/orange */
            border-color: #fcd34d;
        }

        .tr-sentence {
            display: none;
            margin-top: 8px;
            color: #ea580c; /* orange-600 */
            font-weight: 600;
            font-style: italic;
            border-left: 4px solid #f97316;
            padding-left: 12px;
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Audio Button in Sentence */
        .sent-audio-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background-color: #fef3c7;
            color: #d97706;
            border-radius: 50%;
            margin-right: 8px;
            font-size: 14px;
            transition: all 0.2s;
            border: 1px solid #fcd34d;
        }
        .sent-audio-btn:hover {
            background-color: #f59e0b;
            color: white;
            transform: scale(1.1);
        }

        /* Tooltip for words */
        #word-tooltip {
            position: absolute;
            background: #1e293b;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 13px;
            pointer-events: none;
            z-index: 50;
            display: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            white-space: nowrap;
        }
        #word-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #1e293b transparent transparent transparent;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen pb-20">

    <div id="word-tooltip">Translation</div>

    <header class="bg-white p-6 text-center shadow-sm border-b border-gray-200 sticky top-0 z-20">
        <h1 class="text-2xl md:text-3xl font-extrabold text-gray-800 tracking-tight mb-1">History Heroes & Grammar</h1>
        <p class="text-gray-500 text-sm md:text-base">Interactive Lesson: Seyit OnbaÅŸÄ± & Nene Hatun</p>
    </header>

    <nav class="sticky top-[88px] z-10 bg-gray-100 pt-2 pb-4 px-2">
        <div class="flex flex-wrap justify-center gap-2">
            <button onclick="switchTab('reading')" id="btn-reading" class="tab-btn flex items-center gap-2 px-4 py-2 rounded-full font-bold transition shadow-sm bg-orange-500 text-white">
                Reading
            </button>
            <button onclick="switchTab('grammar')" id="btn-grammar" class="tab-btn flex items-center gap-2 px-4 py-2 rounded-full font-bold transition bg-white text-blue-600 hover:bg-blue-50">
                Grammar
            </button>
            <button onclick="switchTab('timeline')" id="btn-timeline" class="tab-btn flex items-center gap-2 px-4 py-2 rounded-full font-bold transition bg-white text-green-600 hover:bg-green-50">
                Story Order
            </button>
            <button onclick="switchTab('vocab')" id="btn-vocab" class="tab-btn flex items-center gap-2 px-4 py-2 rounded-full font-bold transition bg-white text-purple-600 hover:bg-purple-50">
                Vocab
            </button>
        </div>
    </nav>

    <main class="max-w-3xl mx-auto p-4">

        <div id="reading" class="tab-content active space-y-6">
            
            <div class="bg-amber-50 p-6 rounded-xl border-l-8 border-amber-500 shadow-sm relative">
                <div class="flex justify-between items-center mb-4 border-b border-amber-200 pb-2">
                    <h2 class="text-2xl font-bold text-amber-800">An Unforgettable Hero: Seyit OnbaÅŸÄ±</h2>
                    <div class="flex gap-2">
                        <button onclick="readStory()" id="btn-play-story" class="flex items-center gap-1 px-3 py-1 bg-amber-600 text-white rounded-full hover:bg-amber-700 text-sm font-bold shadow transition">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg> Read All
                        </button>
                        <button onclick="stopSpeaking()" class="flex items-center gap-1 px-3 py-1 bg-gray-200 text-gray-700 rounded-full hover:bg-gray-300 text-sm font-bold shadow transition">Stop</button>
                    </div>
                </div>
                
                <p class="text-xs text-amber-800 mb-4 bg-amber-100 p-2 rounded inline-block border border-amber-200">
                    ðŸ‘‰ <strong>Tip:</strong> Click <span class="bg-yellow-200 px-1 rounded">ðŸ”Š</span> to listen, click a <u>word</u> for meaning, click the <u>sentence</u> for translation.
                </p>

                <div id="story-container" class="text-gray-800 leading-relaxed text-lg">
                    </div>

            </div>

            <div class="space-y-4 mt-8">
                <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2 border-b pb-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-amber-500"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/></svg>
                    1. Comprehension Check
                </h3>
                <div id="quiz-container" class="space-y-4"></div>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 mt-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">2. True or False Challenge</h3>
                <div id="tf-container" class="grid gap-3"></div>
            </div>
        </div>

        <div id="grammar" class="tab-content space-y-6">
            <div class="bg-blue-50 p-6 rounded-xl border-l-8 border-blue-500 shadow-sm">
                <h2 class="text-2xl font-bold text-blue-800 mb-4">Past Continuous Tense</h2>
                <p class="mb-4 text-gray-700">We use this tense for actions happening at a specific time in the past.</p>
                <div class="bg-white p-4 rounded-lg border border-blue-200 font-mono text-sm md:text-base shadow-sm">
                    <p class="text-green-600 mb-2">I / He / She / It + <strong class="bg-green-100 px-1 rounded">was</strong> + verb<strong>-ing</strong></p>
                    <p class="text-purple-600">We / You / They + <strong class="bg-purple-100 px-1 rounded">were</strong> + verb<strong>-ing</strong></p>
                </div>
                <p class="mt-4 italic text-gray-600 border-l-4 border-gray-300 pl-3 cursor-pointer hover:text-blue-600" onclick="speakText('While he was running in the park, he saw a dog.')">Example: "While he <strong>was running</strong> in the park, he saw a dog." (Click to listen)</p>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <h3 class="text-lg font-bold text-gray-800 mb-6">1. Fill in the blanks (Watch your spelling!)</h3>
                <div id="grammar-container" class="space-y-6"></div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <h3 class="text-lg font-bold text-gray-800 mb-2">2. Sentence Scramble</h3>
                <p class="text-sm text-gray-500 mb-4">Click words in order to build: <em>"Peace of cake (Sizin iÃ§in Ã‡ocuk oyuncaÄŸÄ±)"</em></p>
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 text-center">
                    <div id="scramble-dropzone" class="min-h-[60px] bg-white border-2 border-dashed border-blue-300 rounded-lg mb-4 flex flex-wrap gap-2 p-3 justify-center items-center text-lg font-medium text-blue-800 transition-colors"></div>
                    <div id="scramble-bank" class="flex flex-wrap gap-2 justify-center"></div>
                    <div id="scramble-feedback" class="mt-4 font-bold h-6"></div>
                    <button onclick="resetScramble()" class="mt-2 text-xs text-gray-400 underline hover:text-gray-600">Reset</button>
                </div>
            </div>
        </div>

        <div id="timeline" class="tab-content space-y-6">
            <div class="bg-green-50 p-6 rounded-xl border border-green-200 text-center shadow-sm">
                <h2 class="text-2xl font-bold text-green-800 mb-2">The Story of Nene Hatun</h2>
            </div>
            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                <h3 class="text-lg font-bold text-gray-800 mb-2">1. Restore History</h3>
                <p id="timeline-status" class="font-medium text-sm text-green-700 mb-4 bg-green-50 inline-block px-3 py-1 rounded border border-green-200">Start by clicking the 1st event.</p>
                <div id="timeline-container" class="grid grid-cols-1 gap-3"></div>
                <div id="timeline-success" class="hidden text-center p-6 bg-gradient-to-r from-green-100 to-green-200 rounded-xl shadow-inner border border-green-300 animate-pulse mt-4">
                    <h3 class="text-xl font-bold text-green-900">Great Job! History Restored.</h3>
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                <h3 class="text-lg font-bold text-gray-800 mb-4">2. Cause & Effect Match</h3>
                <div class="grid grid-cols-2 gap-4" id="cause-effect-game">
                    <div class="space-y-2" id="col-causes"></div>
                    <div class="space-y-2" id="col-effects"></div>
                </div>
            </div>
        </div>

        <div id="vocab" class="tab-content space-y-6">
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-purple-50 p-5 rounded-xl shadow-sm border border-purple-100">
                    <h3 class="text-xl font-bold text-purple-900 mb-4 flex items-center gap-2">1. Vocabulary Match</h3>
                    <div class="space-y-3" id="vocab-list"></div>
                </div>
                <div class="bg-pink-50 p-5 rounded-xl shadow-sm border border-pink-100">
                    <h3 class="text-xl font-bold text-pink-900 mb-4 flex items-center gap-2">2. Pronunciation Sort</h3>
                    <div class="grid grid-cols-3 gap-2 text-center font-bold text-white mb-4 text-sm">
                        <div class="bg-blue-400 rounded p-1">/id/</div>
                        <div class="bg-green-400 rounded p-1">/t/</div>
                        <div class="bg-red-400 rounded p-1">/d/</div>
                    </div>
                    <div class="space-y-2" id="pronunciation-list"></div>
                </div>
            </div>
            <div class="bg-yellow-50 p-6 rounded-xl border-l-4 border-yellow-400 shadow-sm">
                <h3 class="text-xl font-bold text-yellow-900 mb-2 flex items-center gap-2">3. Audio Spelling Bee</h3>
                <div class="flex flex-wrap gap-4" id="spelling-container"></div>
            </div>
        </div>

    </main>

    <script>
        // --- SHARED UTILITIES ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const synth = window.speechSynthesis;

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if (type === 'correct') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(600, now); osc.frequency.exponentialRampToValueAtTime(1200, now + 0.1);
                gainNode.gain.setValueAtTime(0.2, now); gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
                osc.start(now); osc.stop(now + 0.5);
            } else if (type === 'wrong') {
                osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, now); osc.frequency.linearRampToValueAtTime(100, now + 0.3);
                gainNode.gain.setValueAtTime(0.2, now); gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                osc.start(now); osc.stop(now + 0.3);
            } else if (type === 'click') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(400, now);
                gainNode.gain.setValueAtTime(0.1, now); gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now); osc.stop(now + 0.1);
            } else if (type === 'success') {
                [523.25, 659.25, 783.99, 1046.50].forEach((freq, i) => {
                    const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
                    o.connect(g); g.connect(audioCtx.destination);
                    o.frequency.value = freq;
                    g.gain.setValueAtTime(0.1, now + i*0.1); g.gain.exponentialRampToValueAtTime(0.001, now + i*0.1 + 0.4);
                    o.start(now + i*0.1); o.stop(now + i*0.1 + 0.4);
                });
            }
        }

        function speakText(text) {
            if(synth.speaking) synth.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US'; utterance.rate = 0.9;
            synth.speak(utterance);
        }

        // --- NEW TRANSLATION ENGINE ---

        const dictionary = {
            "When": "Ne zaman/dÄ±ÄŸÄ±nda", "you": "sen", "visit": "ziyaret etmek", "Gallipoli": "Gelibolu", "can": "-ebilmek", "see": "gÃ¶rmek", "the": "(belirtme)", "huge": "devasa", "statue": "heykel", "of": "-in/-nÄ±n", "Seyit": "Seyit", "OnbaÅŸÄ±": "OnbaÅŸÄ±", "shows": "gÃ¶stermek", "him": "onu", "with": "ile", "a": "bir", "big": "bÃ¼yÃ¼k", "shell": "top mermisi", "in": "iÃ§inde", "his": "onun", "arms": "kollarÄ±", "was": "idi", "an": "bir", "Ottoman": "OsmanlÄ±", "soldier": "asker", "during": "sÄ±rasÄ±nda", "war": "savaÅŸ", "Ã‡anakkale": "Ã‡anakkale", "He": "O", "became": "oldu", "After": "Sonra", "years": "yÄ±l", "still": "hÃ¢lÃ¢", "serving": "gÃ¶rev yapmak", "Rumeli": "Rumeli", "Mecidiye": "Mecidiye", "Batarya": "BataryasÄ±", "Soldiers": "Askerler", "were": "idiler", "fighting": "savaÅŸmak", "on": "Ã¼zerinde", "hills": "tepeler", "and": "ve", "valleys": "vadiler", "under": "altÄ±nda", "rain": "yaÄŸmur", "fire": "ateÅŸ", "They": "Onlar", "fired": "ateÅŸledi", "at": "-e/-a", "ship": "gemi", "Queen": "KraliÃ§e", "Elizabeth": "Elizabeth", "hit": "vurdu", "her": "onu", "enemy": "dÃ¼ÅŸman", "back": "geri", "to": "-e/-a", "killed": "Ã¶ldÃ¼rdÃ¼", "almost": "neredeyse", "all": "tÃ¼mÃ¼", "Turkish": "TÃ¼rk", "destroyed": "yok etti", "most": "Ã§oÄŸu", "guns": "silahlar/toplar", "There": "Orada", "dust": "toz", "blood": "kan", "cries": "feryatlar/aÄŸlamalar", "everywhere": "her yerde", "While": "-iken", "commander": "komutan", "walking": "yÃ¼rÃ¼mek", "among": "arasÄ±nda", "dead": "Ã¶lÃ¼", "saw": "gÃ¶rdÃ¼", "stones": "taÅŸlar", "soil": "toprak", "tall": "uzun", "strong": "gÃ¼Ã§lÃ¼", "man": "adam", "helped": "yardÄ±m etti", "stand": "ayaÄŸa kalkmak", "up": "yukarÄ±", "feet": "ayaklar", "only": "sadece", "one": "bir", "cannon": "top", "good": "iyi", "condition": "durum", "but": "fakat", "it": "o", "didn't": "yapmadÄ±", "work": "Ã§alÄ±ÅŸmak", "well": "iyi", "moved": "hareket etti", "First": "Ã–nce", "lifted": "kaldÄ±rdÄ±", "kg": "kilogram", "help": "yardÄ±m", "friend": "arkadaÅŸ", "then": "sonra", "put": "koydu", "shoulder": "omuz", "finally": "sonunda", "climbed": "tÄ±rmandÄ±", "placed": "yerleÅŸtirdi", "His": "Onun", "love": "sevgi", "country": "Ã¼lke", "warship": "savaÅŸ gemisi", "Ocean": "Ocean (Gemi adÄ±)", "sank": "battÄ±", "British": "Ä°ngiliz", "Admiral": "Amiral", "told": "sÃ¶yledi", "leave": "ayrÄ±lmak", "evening": "akÅŸam", "March": "Mart", "sun": "gÃ¼neÅŸ", "going": "gitmek/batmak", "down": "aÅŸaÄŸÄ±", "last": "son", "sailing": "denize aÃ§Ä±lmak", "away": "uzak", "commanders": "komutanlar", "very": "Ã§ok", "happy": "mutlu", "Cevat": "Cevat", "PaÅŸa": "PaÅŸa", "Fortified": "MÃ¼stahkem", "Zone": "Mevki", "said": "dedi", "left": "terk etti", "our": "bizim", "coast": "kÄ±yÄ±", "could": "-ebilirdi", "not": "deÄŸil", "break": "kÄ±rmak", "through": "iÃ§inden/yarÄ±p geÃ§mek", "will": "-ecek/-acak"
        };

        const storySentences = [
            {
                en: "When you visit Gallipoli, you can see the huge statue of Seyit OnbaÅŸÄ±.",
                tr: "Gelibolu'yu ziyaret ettiÄŸinizde, Seyit OnbaÅŸÄ±'nÄ±n devasa heykelini gÃ¶rebilirsiniz."
            },
            {
                en: "The statue shows him with a big shell in his arms.",
                tr: "Heykel onu kollarÄ±nda bÃ¼yÃ¼k bir top mermisiyle gÃ¶sterir."
            },
            {
                en: "Seyit OnbaÅŸÄ± was an Ottoman soldier during the war of Ã‡anakkale.",
                tr: "Seyit OnbaÅŸÄ±, Ã‡anakkale SavaÅŸÄ± sÄ±rasÄ±nda bir OsmanlÄ± askeriydi."
            },
            {
                en: "He became a soldier in 1909.",
                tr: "1909 yÄ±lÄ±nda asker oldu."
            },
            {
                en: "After 6 years, he was still serving in Ã‡anakkale Rumeli Mecidiye Batarya in 1915.",
                tr: "6 yÄ±l sonra, 1915'te hala Ã‡anakkale Rumeli Mecidiye BataryasÄ±'nda gÃ¶rev yapÄ±yordu."
            },
            {
                en: "Soldiers were fighting on hills and valleys under a rain of fire.",
                tr: "Askerler ateÅŸ yaÄŸmuru altÄ±nda tepelerde ve vadilerde savaÅŸÄ±yorlardÄ±."
            },
            {
                en: "They fired shells at the ship Queen Elizabeth and hit her.",
                tr: "Queen Elizabeth gemisine top mermileri attÄ±lar ve onu vurdular."
            },
            {
                en: "After that, the enemy fired back to Mecidiye Batarya, killed almost all of the Turkish soldiers and destroyed most of the guns.",
                tr: "Bundan sonra dÃ¼ÅŸman Mecidiye BataryasÄ±'na karÅŸÄ±lÄ±k verdi, TÃ¼rk askerlerinin neredeyse hepsini Ã¶ldÃ¼rdÃ¼ ve toplarÄ±n Ã§oÄŸunu yok etti."
            },
            {
                en: "There was dust, blood and cries everywhere.",
                tr: "Her yerde toz, kan ve feryatlar vardÄ±."
            },
            {
                en: "While the batarya commander and a soldier were walking among the dead soldiers, they saw a soldier under stones and soil.",
                tr: "Batarya komutanÄ± ve bir asker Ã¶lÃ¼ askerlerin arasÄ±nda yÃ¼rÃ¼rken, taÅŸlarÄ±n ve topraÄŸÄ±n altÄ±nda bir asker gÃ¶rdÃ¼ler."
            },
            {
                en: "He was Seyit OnbaÅŸÄ±.",
                tr: "O, Seyit OnbaÅŸÄ±'ydÄ±."
            },
            {
                en: "He was a tall and strong man.",
                tr: "Uzun ve gÃ¼Ã§lÃ¼ bir adamdÄ±."
            },
            {
                en: "They helped him to stand up.",
                tr: "AyaÄŸa kalkmasÄ±na yardÄ±m ettiler."
            },
            {
                en: "When Seyit OnbaÅŸÄ± was on his feet, he saw that there was only one cannon in good condition, but it didn't work well.",
                tr: "Seyit OnbaÅŸÄ± ayaÄŸa kalktÄ±ÄŸÄ±nda, iyi durumda sadece bir top olduÄŸunu ama onun da iyi Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± gÃ¶rdÃ¼."
            },
            {
                en: "Seyit moved.",
                tr: "Seyit hareket etti."
            },
            {
                en: "First, he lifted the 275 kg shell with the help of his friend, then, put it on his shoulder and finally climbed up to the gun and placed the shell.",
                tr: "Ã–nce arkadaÅŸÄ±nÄ±n yardÄ±mÄ±yla 275 kg'lÄ±k mermiyi kaldÄ±rdÄ±, sonra omzuna koydu ve nihayet topa tÄ±rmanÄ±p mermiyi yerleÅŸtirdi."
            },
            {
                en: "His love for his country helped him and he fired the cannon.",
                tr: "Vatan sevgisi ona yardÄ±m etti ve topu ateÅŸledi."
            },
            {
                en: "The shell hit the warship Ocean and sank it.",
                tr: "Mermi Ocean adlÄ± savaÅŸ gemisine isabet etti ve onu batÄ±rdÄ±."
            },
            {
                en: "The British Admiral told his warships to leave.",
                tr: "Ä°ngiliz Amiral savaÅŸ gemilerine ayrÄ±lmalarÄ±nÄ± sÃ¶yledi."
            },
            {
                en: "In the evening of March 18, while the sun was going down and the last enemy warships were sailing away, Turkish commanders were very happy.",
                tr: "18 Mart akÅŸamÄ±, gÃ¼neÅŸ batarken ve son dÃ¼ÅŸman gemileri uzaklaÅŸÄ±rken, TÃ¼rk komutanlar Ã§ok mutluydu."
            },
            {
                en: "Cevat PaÅŸa, commander of the Ã‡anakkale Fortified Zone, said: \"They left our coast. They could not break through. They will not break through.\"",
                tr: "Ã‡anakkale MÃ¼stahkem Mevki KomutanÄ± Cevat PaÅŸa ÅŸÃ¶yle dedi: \"KÄ±yÄ±mÄ±zÄ± terk ettiler. GeÃ§emediler. GeÃ§emeyecekler.\""
            }
        ];

        function renderStory() {
            const container = document.getElementById('story-container');
            container.innerHTML = '';

            storySentences.forEach((item, idx) => {
                const sWrapper = document.createElement('div');
                sWrapper.className = 'sentence-wrapper';
                sWrapper.onclick = () => toggleSentenceTr(idx);

                const pEn = document.createElement('p');
                pEn.className = 'flex items-start mb-1';
                
                // Audio Button for Sentence
                const audioBtn = document.createElement('button');
                audioBtn.innerHTML = 'ðŸ”Š';
                audioBtn.className = 'sent-audio-btn flex-shrink-0';
                audioBtn.onclick = (e) => {
                    e.stopPropagation();
                    speakText(item.en);
                    audioBtn.classList.add('animate-ping');
                    setTimeout(() => audioBtn.classList.remove('animate-ping'), 1000);
                };

                // Text container
                const textSpan = document.createElement('span');
                
                const words = item.en.split(' ');
                words.forEach(word => {
                    const cleanWord = word.replace(/[.,":;]/g, ''); 
                    const trMeaning = dictionary[cleanWord] || "?";
                    
                    const span = document.createElement('span');
                    span.className = 'interactive-word';
                    span.textContent = word + ' '; 
                    span.onclick = (e) => showWordTooltip(e, cleanWord, trMeaning);
                    textSpan.appendChild(span);
                });

                pEn.appendChild(audioBtn);
                pEn.appendChild(textSpan);

                const pTr = document.createElement('p');
                pTr.id = `tr-sent-${idx}`;
                pTr.className = 'tr-sentence';
                pTr.textContent = item.tr;

                sWrapper.appendChild(pEn);
                sWrapper.appendChild(pTr);
                container.appendChild(sWrapper);
            });
        }

        function toggleSentenceTr(idx) {
            const trEl = document.getElementById(`tr-sent-${idx}`);
            if(trEl.style.display === 'block') {
                trEl.style.display = 'none';
            } else {
                document.querySelectorAll('.tr-sentence').forEach(el => el.style.display = 'none'); 
                trEl.style.display = 'block';
            }
        }

        function showWordTooltip(e, word, meaning) {
            e.stopPropagation(); 
            const tooltip = document.getElementById('word-tooltip');
            tooltip.textContent = `${word} : ${meaning}`;
            tooltip.style.display = 'block';
            
            const rect = e.target.getBoundingClientRect();
            const scrollX = window.pageXOffset;
            const scrollY = window.pageYOffset;

            tooltip.style.left = (rect.left + scrollX + (rect.width / 2) - (tooltip.offsetWidth / 2)) + 'px';
            tooltip.style.top = (rect.top + scrollY - 35) + 'px';

            setTimeout(() => {
                tooltip.style.display = 'none';
            }, 3000);
        }
        
        renderStory();

        // --- TAB & AUDIO LOGIC ---

        function readStory() {
            if(synth.speaking) synth.cancel();
            const btn = document.getElementById('btn-play-story');
            btn.classList.add('speaking-anim');
            const fullText = storySentences.map(s => s.en).join(" ");
            const utterance = new SpeechSynthesisUtterance(fullText);
            utterance.lang = 'en-US'; utterance.rate = 0.9;
            utterance.onend = () => btn.classList.remove('speaking-anim');
            synth.speak(utterance);
        }

        function stopSpeaking() {
            synth.cancel();
            const btn = document.getElementById('btn-play-story');
            if(btn) btn.classList.remove('speaking-anim');
        }

        function switchTab(tabId) {
            stopSpeaking();
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-orange-500', 'bg-blue-500', 'bg-green-500', 'bg-purple-500', 'text-white', 'shadow-md');
                btn.classList.add('bg-white');
            });
            const activeBtn = document.getElementById('btn-' + tabId);
            activeBtn.classList.remove('bg-white');
            if(tabId === 'reading') activeBtn.classList.add('bg-orange-500', 'text-white', 'shadow-md');
            if(tabId === 'grammar') activeBtn.classList.add('bg-blue-500', 'text-white', 'shadow-md');
            if(tabId === 'timeline') activeBtn.classList.add('bg-green-500', 'text-white', 'shadow-md');
            if(tabId === 'vocab') activeBtn.classList.add('bg-purple-500', 'text-white', 'shadow-md');
        }

        // --- EXERCISES LOGIC ---
        
        // UPDATED QUIZ QUESTIONS
        const quizData = [
            { q: "Who was Seyit OnbaÅŸÄ±?", opts: ["An Ottoman soldier", "A British Admiral", "A school teacher", "A tourist in Gallipoli"], a: 0 },
            { q: "What happened when the enemy fired back?", opts: ["They killed almost all soldiers", "They missed the target", "They surrendered immediately", "They ran away scared"], a: 0 },
            { q: "What were the commander and a soldier doing when they found Seyit?", opts: ["Walking among the dead soldiers", "Firing the cannons", "Eating dinner", "Sleeping in the tent"], a: 0 },
            { q: "What was Seyit OnbaÅŸÄ± like?", opts: ["Short and weak", "Tall and strong", "Old and tired", "Young and fearful"], a: 1 },
            { q: "How many cannons were in good condition?", opts: ["Five", "Ten", "None", "Only one"], a: 3 },
            { q: "Who fired the cannon?", opts: ["The Commander", "Seyit OnbaÅŸÄ±", "The British Admiral", "The soldier's friend"], a: 1 },
            { q: "What was happening when the sun was going down?", opts: ["The last enemy warships were sailing away", "The battle was just starting", "It started to rain heavily", "More enemy ships arrived"], a: 0 }
        ];
        const quizContainer = document.getElementById('quiz-container');
        quizData.forEach((item, idx) => {
            const qDiv = document.createElement('div');
            qDiv.className = "bg-white p-4 rounded-lg shadow border border-gray-100";
            qDiv.innerHTML = `<p class="font-semibold text-gray-800 mb-3">${idx + 1}. ${item.q}</p>`;
            const optDiv = document.createElement('div');
            optDiv.className = "space-y-2";
            item.opts.forEach((opt, optIdx) => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left px-4 py-2 rounded-md transition-colors bg-gray-50 hover:bg-gray-100 text-gray-700 border border-transparent text-sm";
                btn.textContent = opt;
                btn.onclick = () => {
                    Array.from(optDiv.children).forEach(b => { b.className = "w-full text-left px-4 py-2 rounded-md bg-gray-50 text-gray-400 text-sm"; b.disabled = true; });
                    if(optIdx === item.a) {
                        btn.className = "w-full text-left px-4 py-2 rounded-md bg-green-100 text-green-800 border-l-4 border-green-500 font-medium correct-anim text-sm";
                        btn.innerHTML += ' âœ…'; playSound('correct');
                    } else {
                        btn.className = "w-full text-left px-4 py-2 rounded-md bg-red-100 text-red-800 border-l-4 border-red-500 text-sm";
                        btn.innerHTML += ' âŒ'; playSound('wrong');
                    }
                };
                optDiv.appendChild(btn);
            });
            qDiv.appendChild(optDiv);
            quizContainer.appendChild(qDiv);
        });

        // True/False
        const tfData = [
            { s: "Seyit OnbaÅŸÄ± served in the Ã‡anakkale war in 1915.", a: true },
            { s: "The statue shows him holding a rifle.", a: false },
            { s: "He lifted the shell alone with the help of a friend.", a: true },
            { s: "The British Admiral ordered his ships to attack more.", a: false }
        ];
        const tfContainer = document.getElementById('tf-container');
        tfData.forEach((item, i) => {
            const row = document.createElement('div');
            row.className = "flex flex-col sm:flex-row items-center justify-between bg-gray-50 p-3 rounded border border-gray-100";
            row.innerHTML = `
                <span class="text-gray-800 mb-2 sm:mb-0 text-sm flex-1 mr-2">${item.s}</span>
                <div class="flex gap-2">
                    <button onclick="checkTF(this, ${item.a}, true)" class="px-3 py-1 rounded border border-green-600 text-green-600 hover:bg-green-50 font-bold text-xs">TRUE</button>
                    <button onclick="checkTF(this, ${item.a}, false)" class="px-3 py-1 rounded border border-red-600 text-red-600 hover:bg-red-50 font-bold text-xs">FALSE</button>
                </div>
            `;
            tfContainer.appendChild(row);
        });
        function checkTF(btn, correctVal, clickedVal) {
            const parent = btn.parentElement;
            Array.from(parent.children).forEach(b => b.disabled = true);
            if(correctVal === clickedVal) {
                btn.classList.add('bg-green-600', 'text-white', 'border-green-600', 'correct-anim');
                playSound('correct');
            } else {
                btn.classList.add('bg-red-600', 'text-white', 'border-red-600');
                playSound('wrong');
            }
        }

        // Grammar
        const grammarData = [
            { id: 1, pre: "She left home while her baby", answer: "was sleeping", post: "." },
            { id: 2, pre: "Mostly women and elderly people", answer: "were fighting", post: "there." },
            { id: 3, pre: "Nene Hatun", answer: "was holding", post: "her brother's bayonet." },
            { id: 4, pre: "Dead bodies", answer: "were lying", post: "around." },
        ];
        const gContainer = document.getElementById('grammar-container');
        grammarData.forEach(item => {
            const div = document.createElement('div');
            div.className = "flex flex-col md:flex-row md:items-center gap-2 pb-4 border-b border-gray-100 last:border-0";
            div.innerHTML = `
                <span class="text-gray-700 text-sm md:text-base">${item.id}. ${item.pre}</span>
                <div class="flex items-center gap-2">
                    <input type="text" id="g-input-${item.id}" class="border-2 px-2 py-1 rounded w-32 border-gray-300 focus:border-blue-400 focus:outline-none" placeholder="verb + ing">
                    <button onclick="checkGrammar(${item.id}, '${item.answer}')" class="bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700 shadow-sm">Check</button>
                </div>
                <span class="text-gray-700 text-sm md:text-base">${item.post}</span>
            `;
            gContainer.appendChild(div);
        });
        function checkGrammar(id, correct) {
            const input = document.getElementById(`g-input-${id}`);
            const val = input.value.trim().toLowerCase();
            if(val === correct) {
                input.classList.replace('border-gray-300', 'border-green-500');
                input.classList.add('bg-green-50');
                playSound('correct');
            } else {
                input.classList.replace('border-gray-300', 'border-red-500');
                input.classList.add('bg-red-50');
                playSound('wrong');
            }
        }

        // Scramble
        const correctScramble = "He was carrying a heavy shell";
        const scrambledWords = ["heavy", "carrying", "was", "He", "shell", "a"];
        let currentScramble = [];
        const dropzone = document.getElementById('scramble-dropzone');
        const bank = document.getElementById('scramble-bank');
        const feedback = document.getElementById('scramble-feedback');
        function initScramble() {
            bank.innerHTML = ''; dropzone.innerHTML = ''; currentScramble = [];
            feedback.textContent = ''; 
            dropzone.classList.remove('border-green-500'); dropzone.classList.add('border-blue-300');
            scrambledWords.forEach(word => {
                const btn = document.createElement('button');
                btn.textContent = word;
                btn.className = "px-3 py-1 bg-white border border-blue-400 text-blue-700 rounded shadow hover:bg-blue-50 word-move text-sm";
                btn.onclick = () => addToZone(btn, word);
                bank.appendChild(btn);
            });
        }
        initScramble();
        function addToZone(btn, word) {
            playSound('click'); btn.remove();
            const newBtn = document.createElement('button');
            newBtn.textContent = word;
            newBtn.className = "px-3 py-1 bg-blue-100 border border-blue-500 text-blue-900 rounded shadow hover:bg-red-50 word-move text-sm";
            newBtn.onclick = () => returnToBank(newBtn, word);
            dropzone.appendChild(newBtn);
            currentScramble.push(word);
            checkScramble();
        }
        function returnToBank(btn, word) {
            playSound('click'); btn.remove();
            const newBtn = document.createElement('button');
            newBtn.textContent = word;
            newBtn.className = "px-3 py-1 bg-white border border-blue-400 text-blue-700 rounded shadow hover:bg-blue-50 word-move text-sm";
            newBtn.onclick = () => addToZone(newBtn, word);
            bank.appendChild(newBtn);
            currentScramble = currentScramble.filter(w => w !== word);
            feedback.textContent = '';
        }
        function checkScramble() {
            if(currentScramble.join(" ") === correctScramble) {
                playSound('correct');
                feedback.textContent = "Correct! Well done.";
                feedback.classList.add('text-green-600');
                dropzone.classList.replace('border-blue-300', 'border-green-500');
            }
        }
        function resetScramble() { initScramble(); }

        // Timeline
        const timelineEvents = [
            { id: 'a', text: "Nene Hatun's brother got wounded and died.", order: 1 },
            { id: 'd', text: "The Russian Army captured Fort Aziziye.", order: 2 },
            { id: 'b', text: "She kissed her brother's head.", order: 3 },
            { id: 'e', text: "She took her brother's bayonet.", order: 4 },
            { id: 'c', text: "She went to the battlefield.", order: 5 },
            { id: 'f', text: "Her son Yusuf died.", order: 6 },
        ];
        let currentStep = 1;
        const statusEl = document.getElementById('timeline-status');
        const tlContainer = document.getElementById('timeline-container');
        function shuffle(array) { return array.sort(() => Math.random() - 0.5); }
        shuffle(timelineEvents).forEach(ev => {
            const btn = document.createElement('button');
            btn.className = "timeline-item p-3 rounded-lg text-left transition-all duration-300 border bg-white border-gray-200 hover:border-green-400 hover:shadow-sm group";
            btn.setAttribute('data-order', ev.order);
            btn.innerHTML = `<div class="flex items-center gap-3 pointer-events-none"><div class="w-6 h-6 rounded-full bg-gray-100 text-gray-400 flex items-center justify-center text-xs font-bold border border-gray-300 group-hover:bg-green-50 group-hover:text-green-600">?</div><span class="text-sm md:text-base text-gray-700">${ev.text}</span></div>`;
            btn.onclick = function() {
                const order = parseInt(this.getAttribute('data-order'));
                if(order === currentStep) {
                    this.classList.remove('bg-white', 'border-gray-200');
                    this.classList.add('bg-green-100', 'border-green-500', 'opacity-80', 'order-last');
                    this.querySelector('.rounded-full').innerHTML = 'âœ“';
                    this.querySelector('.rounded-full').className = 'w-6 h-6 rounded-full bg-green-500 text-white flex items-center justify-center text-xs font-bold';
                    this.disabled = true;
                    currentStep++; playSound('correct');
                    statusEl.textContent = "Correct! What happened next?";
                    if(currentStep > 6) {
                        document.getElementById('timeline-success').classList.remove('hidden');
                        statusEl.textContent = "All done! History restored.";
                        playSound('success');
                    }
                } else if (order < currentStep) {
                    statusEl.textContent = "You already did that one!";
                } else {
                    statusEl.textContent = "Incorrect order. Try again!";
                    playSound('wrong');
                }
            };
            tlContainer.appendChild(btn);
        });

        // Cause & Effect
        const pairs = [
            { c: "The shell hit the ship", e: "The ship sank" },
            { c: "The Russians attacked", e: "Nene Hatun joined the fight" },
            { c: "Seyit was very strong", e: "He could lift 275kg" },
            { c: "He loved his country", e: "He fought bravely" }
        ];
        let selectedCause = null;
        const causes = pairs.map((p, i) => ({txt: p.c, id: i}));
        const effects = pairs.map((p, i) => ({txt: p.e, id: i})).sort(() => Math.random() - 0.5);
        const colC = document.getElementById('col-causes');
        const colE = document.getElementById('col-effects');
        causes.forEach(item => {
            const btn = document.createElement('button');
            btn.className = "w-full p-3 bg-orange-50 border border-orange-200 rounded text-sm text-left hover:bg-orange-100 transition";
            btn.textContent = item.txt;
            btn.onclick = () => {
                playSound('click');
                document.querySelectorAll('#col-causes button').forEach(b => b.classList.remove('ring-2', 'ring-orange-400', 'bg-orange-200'));
                btn.classList.add('ring-2', 'ring-orange-400', 'bg-orange-200');
                selectedCause = { id: item.id, el: btn };
            };
            colC.appendChild(btn);
        });
        effects.forEach(item => {
            const btn = document.createElement('button');
            btn.className = "w-full p-3 bg-blue-50 border border-blue-200 rounded text-sm text-left hover:bg-blue-100 transition";
            btn.textContent = item.txt;
            btn.onclick = () => {
                if(!selectedCause) return;
                if(selectedCause.id === item.id) {
                    playSound('correct');
                    btn.classList.add('bg-green-100', 'text-gray-400', 'line-through', 'border-green-200');
                    selectedCause.el.classList.add('bg-green-100', 'text-gray-400', 'line-through', 'border-green-200');
                    selectedCause.el.classList.remove('ring-2', 'ring-orange-400', 'bg-orange-200');
                    btn.disabled = true; selectedCause.el.disabled = true;
                    selectedCause = null;
                } else {
                    playSound('wrong');
                    btn.classList.add('bg-red-100');
                    setTimeout(() => btn.classList.remove('bg-red-100'), 500);
                }
            };
            colE.appendChild(btn);
        });

        // Vocab
        const vocabList = [
            { word: "Capture", def: "Take into one's possession or control by force" },
            { word: "Unconscious", def: "Not awake and aware of one's environment" },
            { word: "Battlefield", def: "Arena of war" },
            { word: "Martyr", def: "A person who is killed because of his/her beliefs" }
        ];
        const vList = document.getElementById('vocab-list');
        vocabList.forEach(v => {
            const safeDef = v.def.replace(/'/g, "\\'");
            vList.innerHTML += `
                <div class="bg-white p-3 rounded-lg shadow-sm border border-purple-100 hover:shadow-md transition flex justify-between items-center group cursor-pointer" onclick="speakText('${v.word}. ${safeDef}')">
                    <div><span class="font-bold text-purple-700 block group-hover:text-purple-900">${v.word}</span><span class="text-xs text-gray-600">${v.def}</span></div>
                    <div class="text-purple-300 group-hover:text-purple-600">ðŸ”Š</div>
                </div>`;
        });

        // Pronunciation
        const pronunciationWords = [
            { word: "Wanted", type: "/id/" }, { word: "Looked", type: "/t/" },
            { word: "Cleaned", type: "/d/" }, { word: "Decided", type: "/id/" },
            { word: "Kissed", type: "/t/" }, { word: "Saved", type: "/d/" }
        ];
        const pList = document.getElementById('pronunciation-list');
        pronunciationWords.forEach(w => {
            let color = w.type === '/id/' ? 'bg-blue-100 text-blue-600' : w.type === '/t/' ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600';
            pList.innerHTML += `
                <button onclick="speakText('${w.word}'); playSound('click')" class="w-full flex justify-between items-center bg-white p-2 rounded-lg border border-gray-100 shadow-sm hover:bg-pink-50 transition text-left">
                    <span class="text-gray-800 text-sm font-medium flex items-center gap-2">ðŸ”Š ${w.word}</span>
                    <span class="text-xs font-bold font-mono px-2 py-1 rounded-full ${color}">${w.type}</span>
                </button>`;
        });

        // Spelling
        const spellingWords = ["statue", "soldier", "valley", "cannon"];
        const spellCont = document.getElementById('spelling-container');
        spellingWords.forEach(word => {
            const wrapper = document.createElement('div');
            wrapper.className = "bg-white p-3 rounded shadow border flex items-center gap-2";
            wrapper.innerHTML = `
                <button onclick="speakText('${word}')" class="bg-yellow-100 p-2 rounded-full hover:bg-yellow-200 text-yellow-700 transition"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg></button>
                <input type="text" class="border-b-2 border-gray-300 focus:border-yellow-500 outline-none w-24 text-center text-sm p-1" placeholder="Type here">
                <button class="check-btn text-xs bg-gray-200 px-2 py-1 rounded hover:bg-gray-300 transition">Check</button>
            `;
            const input = wrapper.querySelector('input');
            const checkBtn = wrapper.querySelector('.check-btn');
            checkBtn.onclick = () => {
                if(input.value.toLowerCase().trim() === word) {
                    playSound('correct');
                    input.classList.add('text-green-600', 'font-bold'); input.disabled = true;
                    checkBtn.textContent = "âœ”"; checkBtn.classList.replace('bg-gray-200', 'bg-green-200');
                } else {
                    playSound('wrong');
                    input.classList.add('text-red-600');
                    setTimeout(() => input.classList.remove('text-red-600'), 500);
                }
            };
            spellCont.appendChild(wrapper);
        });

    </script>
</body>
</html>

